   
```
 // 订阅消息相关（从接口拉取）
    submsgSetting: null,
```

```
    //进入页面：先拉取订阅配置，再提示开启订阅
    _this.getSubmsgSetting(() => {
      wx.showModal({
        content: '是否开启订阅消息通知？',
        showCancel: true,
        success(res) {
          if (res.confirm) {
            _this._onRequestSubscribeMessage(() => {});
          }
        }
      });
    });
```

```
 /**
   * 获取订阅消息配置
   */
  getSubmsgSetting(callback) {
    let _this = this;
    App._get('wxapp.submsg/setting', {}, (result) => {
      _this.setData({
        submsgSetting: result.data.setting || null
      }, () => {
        callback && callback();
      });
    });
  },
```

```
  _get(url, data, success, fail, complete, check_login) {
    wx.showNavigationBarLoading();
    let _this = this;
    // 构造请求参数
    data = data || {};
    data.wxapp_id = _this.getWxappId();
    // if (typeof check_login === 'undefined')
    //   check_login = true;
    // 构造get请求
    let request = () => {
      data.token = wx.getStorageSync('token');
      wx.request({
        url: _this.api_root + url,
        header: {
          'content-type': 'application/json'
        },
        data: data,
        success(res) {
          if (res.statusCode !== 200 || typeof res.data !== 'object') {
            console.log(res);
            _this.showError('网络请求出错');
            return false;
          }
          if (res.data.code === -1) {
            // 登录态失效, 重新登录
            wx.hideNavigationBarLoading();
            _this.doLogin(2);
          } else if (res.data.code === 0) {
            _this.showError(res.data.msg, () => {
              fail && fail(res);
            });
            return false;
          } else {
            success && success(res.data);
          }
        },
        fail(res) {
          _this.showError(res.errMsg, () => {
            fail && fail(res);
          });
        },
        complete(res) {
          wx.hideNavigationBarLoading();
          complete && complete(res);
        },
      });
    };
    // 判断是否需要验证登录
    check_login ? _this.doLogin(request) : request();
  },
```


```
  /**
   * 请求用户订阅消息（简化范式）
   */
  _onRequestSubscribeMessage(onCommitCallback) {
    let _this = this;
    console.log(_this.data.submsgSetting);
    const setting = _this.data.submsgSetting;
    //  setting 对象中按路径取出需要的三个 template_id
    const tmplIds = [
      setting.order.payment.template_id,    // 支付成功通知
      setting.order.delivery.template_id,   // 发货通知
      setting.order.reply_letter.template_id  // 回信通知
    ];
    if (!tmplIds.length) {
      onCommitCallback && onCommitCallback();
      return;
    }
    wx.requestSubscribeMessage({
      tmplIds: tmplIds,
      success(res) {
         console.log('订阅结果:', res)
            wx.getSetting({
              success (res) {
                withSubscriptions: true,
                console.log(res.authSetting)
                //用户订阅消息设置，接口参数withSubscriptions值为true时才会返回。
                console.log(res.subscriptionsSetting)
              }
          })
      },
      fail(res) {
         console.log('失败结果:', res)
      },
      complete(res) {
        onCommitCallback && onCommitCallback();
      },
    });
  },
```