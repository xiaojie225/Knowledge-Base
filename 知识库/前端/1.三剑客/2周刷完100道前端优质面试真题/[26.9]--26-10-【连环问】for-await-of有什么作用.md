# for-await-of 有什么作用

## 目录

- [核心概念](#核心概念)
- [基本用法](#基本用法)
- [与 Promise.all 的对比](#与-promiseall-的对比)
- [并发执行 vs 顺序执行](#并发执行-vs-顺序执行)
- [实际应用场景](#实际应用场景)
- [AI 总结](#ai-总结)

## 核心概念

`for-await-of` 是用于**遍历多个 Promise** 的语法，它是 `Promise.all()` 的一个替代方案。

- `for-of` 用于遍历普通数据
- `for-await-of` 用于遍历异步数据（Promise）

## 基本用法

创建多个 Promise 示例：

```javascript
function fetchPromise(value) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(value);
    }, 1000);
  });
}

const p1 = fetchPromise(100);
const p2 = fetchPromise(200);
const p3 = fetchPromise(300);
```

传统方式访问：

```javascript
const result1 = await p1;
const result2 = await p2;
const result3 = await p3;

console.log(result1); // 100
console.log(result2); // 200
console.log(result3); // 300
```

## 与 Promise.all 的对比

使用 `Promise.all()`：

```javascript
const list = [p1, p2, p3];
Promise.all(list).then(results => {
  console.log(results); // [100, 200, 300]
});
```

使用 `for-await-of`（更优雅的循环方式）：

```javascript
const list = [p1, p2, p3];

for await (const result of list) {
  console.log(result); // 依次输出 100, 200, 300
}
```

**优势**：`for-await-of` 是循环形式，代码看起来更加优雅，可以在循环中直接获取结果。

## 并发执行 vs 顺序执行

### 并发执行（同时触发）

当 Promise 提前创建好时，它们会**同时执行**：

```javascript
const p1 = fetchPromise(100);
const p2 = fetchPromise(200);
const p3 = fetchPromise(300);

const list = [p1, p2, p3];

for await (const result of list) {
  console.log(result);
}
// 结果：123 同时出现
```

### 顺序执行（一个接一个）

如果想要**按顺序执行**，需要在使用时才创建 Promise：

```javascript
// 方式1：手动顺序调用
const result1 = await fetchPromise(100);
console.log(result1);

const result2 = await fetchPromise(200);
console.log(result2);

const result3 = await fetchPromise(300);
console.log(result3);
// 结果：1 → 2 → 3 依次出现
```

```javascript
// 方式2：循环中动态创建
const arr = [100, 200, 300];

for (const number of arr) {
  const result = await fetchPromise(number);
  console.log(result);
}
// 结果：1 → 2 → 3 依次出现
```

**关键区别**：
- **提前创建 Promise**：立即执行，并发运行
- **使用时创建 Promise**：按需执行，顺序运行

## 实际应用场景

### 文件上传场景

用户选择多个图片文件上传时：

**并发上传**（速度快）：
```javascript
const files = [file1, file2, file3];
const uploadPromises = files.map(file => uploadFile(file));

for await (const result of uploadPromises) {
  console.log('上传完成:', result);
}
```

**顺序上传**（控制顺序）：
```javascript
const files = [file1, file2, file3];

for (const file of files) {
  const result = await uploadFile(file);
  console.log('上传完成:', result);
}
```

根据业务需求选择合适的方式：
- 需要快速完成 → 并发上传
- 需要控制顺序或限制并发数 → 顺序上传

## AI 总结

`for-await-of` 是遍历多个 Promise 的语法糖，相比 `Promise.all()` 提供了更优雅的循环方式。关键要理解：

1. **提前创建 Promise** = 并发执行（同时触发）
2. **使用时创建 Promise** = 顺序执行（一个接一个）

在实际开发中，根据场景选择合适的执行方式，如文件上传可以选择并发提升速度，或选择顺序控制流程。掌握这个语法能体现对异步编程的深入理解。