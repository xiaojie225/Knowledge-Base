# Vue 组件通讯：$parent 和 $refs

## 目录
- [Vue2 与 Vue3 的差异](#vue2-与-vue3-的差异)
- [$parent 的使用](#parent-的使用)
- [$refs 的使用](#refs-的使用)
- [使用时机和注意事项](#使用时机和注意事项)
- [AI 总结](#ai-总结)

## Vue2 与 Vue3 的差异

在 Vue2 中存在 `$parent` 和 `$children` 两个 API，但在 Vue3 中，官方建议使用 `$refs` 替代 `$children`，因此 Vue3 只保留了 `$parent` 和 `$refs`。

## $parent 的使用

### 基本概念
`$parent` 用于获取父组件实例，可以直接访问父组件的属性和方法。

### 示例代码

在子组件的 `mounted` 钩子中获取父组件：

```javascript
mounted() {
  // 获取父组件实例
  const parent = this.$parent;
  
  // 访问父组件的属性
  console.log(parent.x); // 输出: xxx
  console.log(parent.y); // 输出: yyy
  console.log(parent.z); // 输出: zzz
  
  // 调用父组件的方法
  parent.someMethod();
}
```

### 特点
- 可以直接获取父组件的属性
- 可以直接调用父组件的方法
- 适用于父子组件通讯场景

## $refs 的使用

### 基本概念
`$refs` 用于获取子组件实例，需要在模板中先定义 `ref` 属性。

### 示例代码

**父组件模板：**
```vue
<template>
  <HelloWorld 
    ref="hello1" 
    message="Hello" 
  />
</template>
```

**父组件脚本：**
```javascript
import HelloWorld from './HelloWorld.vue';

export default {
  components: {
    HelloWorld
  },
  mounted() {
    // 通过 ref 名称获取子组件实例
    const hello = this.$refs.hello1;
    
    // 访问子组件的 data 属性
    console.log(hello.name); // 输出: Hello World
  }
}
```

**子组件（HelloWorld.vue）：**
```javascript
export default {
  props: ['message'],
  data() {
    return {
      name: 'Hello World'
    }
  }
}
```

### 特点
- 需要在模板中通过 `ref` 属性标记子组件
- 可以获取子组件的属性和方法
- 适用于父组件访问子组件的场景

## 使用时机和注意事项

### 重要限制
**必须在 `mounted` 钩子中使用，不能在 `created` 钩子中使用。**

原因：
- 在 `created` 阶段，组件还没有完全渲染完成
- 组件的 DOM 树还没有完全构建完成
- 此时无法正确获取 `$parent` 或 `$refs`

### 适用场景
- `$parent`：子组件需要访问父组件
- `$refs`：父组件需要访问子组件
- 类似于 `provide/inject`，适合父子组件通讯
- 相比 `provide/inject` 更加直接和方便

## AI 总结

本节介绍了 Vue3 中的两种组件通讯方式：`$parent` 和 `$refs`。`$parent` 允许子组件直接访问父组件的属性和方法，而 `$refs` 则让父组件能够获取子组件实例。这两种方式都必须在 `mounted` 生命周期钩子中使用，因为需要等待组件完全渲染完成。相比 Vue2，Vue3 移除了 `$children`，推荐使用 `$refs` 作为替代方案。这些 API 为父子组件间的直接通讯提供了便捷的方式。