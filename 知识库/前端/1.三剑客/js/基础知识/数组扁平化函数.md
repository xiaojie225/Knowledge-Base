# æ•°ç»„æ‰å¹³åŒ– - å­¦ä¹ èµ„æ–™

---

## ğŸ“š æ—¥å¸¸å­¦ä¹ æ¨¡å¼

**[æ ‡ç­¾: æ•°ç»„æ‰å¹³åŒ–ã€é€’å½’ç®—æ³•ã€æ•°ç»„æ–¹æ³•ã€ES6+]**

### ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ

**æ•°ç»„æ‰å¹³åŒ–**ï¼šå°†å¤šç»´åµŒå¥—æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„çš„è¿‡ç¨‹ã€‚

```javascript
// è¾“å…¥
[1, [2, [3, 4]], 5]
// è¾“å‡º
[1, 2, 3, 4, 5]
```

### äºŒã€å®ç°æ–¹æ³•

#### 1. é€’å½’å®ç°ï¼ˆæ¨èï¼‰

```javascript
/**
 * é€’å½’æ‰å¹³åŒ–æ•°ç»„
 * @param {Array} arr - å¾…æ‰å¹³åŒ–çš„æ•°ç»„
 * @param {number} depth - å±•å¼€æ·±åº¦ï¼Œé»˜è®¤æ— é™æ·±
 * @returns {Array} æ‰å¹³åŒ–åçš„æ•°ç»„
 */
function flatRecursive(arr, depth = Infinity) {
    const result = [];
    for (let i = 0; i < arr.length; i++) {
        // å¦‚æœæ˜¯æ•°ç»„ä¸”æ·±åº¦æœªåˆ°é™åˆ¶ï¼Œé€’å½’å±•å¼€
        if (Array.isArray(arr[i]) && depth > 0) {
            result.push(...flatRecursive(arr[i], depth - 1));
        } else {
            result.push(arr[i]);
        }
    }
    return result;
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šé€šç”¨æ‰å¹³åŒ–ï¼Œæ”¯æŒæ·±åº¦æ§åˆ¶

#### 2. Reduce å®ç°

```javascript
/**
 * ä½¿ç”¨ reduce å®ç°æ‰å¹³åŒ–
 */
function flatReduce(arr, depth = Infinity) {
    return depth > 0 
        ? arr.reduce((acc, val) => 
            acc.concat(Array.isArray(val) ? flatReduce(val, depth - 1) : val), [])
        : arr.slice();
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ï¼Œä»£ç ç®€æ´

#### 3. è¿­ä»£å®ç°ï¼ˆæ ˆï¼‰

```javascript
/**
 * ä½¿ç”¨æ ˆè¿­ä»£å®ç°ï¼ˆé¿å…é€’å½’æ ˆæº¢å‡ºï¼‰
 */
function flatIterative(arr) {
    const stack = [...arr];
    const result = [];
  
    while (stack.length) {
        const item = stack.pop();
        if (Array.isArray(item)) {
            // å°†æ•°ç»„å…ƒç´ é€†åºå‹å…¥æ ˆ
            stack.push(...item);
        } else {
            result.unshift(item);
        }
    }
    return result;
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šå¤„ç†æ·±å±‚åµŒå¥—ï¼Œé¿å…æ ˆæº¢å‡º

#### 4. ç”Ÿæˆå™¨å®ç°

```javascript
/**
 * ä½¿ç”¨ç”Ÿæˆå™¨å®ç°ï¼ˆå†…å­˜å‹å¥½ï¼‰
 */
function* flatGenerator(arr) {
    for (const item of arr) {
        if (Array.isArray(item)) {
            yield* flatGenerator(item);
        } else {
            yield item;
        }
    }
}

// ä½¿ç”¨æ–¹å¼
const result = [...flatGenerator(arr)];
```

**ä½¿ç”¨åœºæ™¯**ï¼šå¤„ç†å¤§æ•°ç»„ï¼ŒæŒ‰éœ€ç”Ÿæˆå…ƒç´ 

#### 5. åŸç”Ÿæ–¹æ³•ï¼ˆES2019+ï¼‰

```javascript
/**
 * ä½¿ç”¨åŸç”Ÿ flat æ–¹æ³•
 */
arr.flat(depth); // depth é»˜è®¤ä¸º 1
```

**ä½¿ç”¨åœºæ™¯**ï¼šç°ä»£æµè§ˆå™¨ç¯å¢ƒï¼Œæ€§èƒ½æœ€ä¼˜

### ä¸‰ã€å…³é”®çŸ¥è¯†ç‚¹

#### 1. é€’å½’ä¸‰è¦ç´ 
- **é€’å½’å‡ºå£**ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ + æ·±åº¦é™åˆ¶
- **é€’å½’ä½“**ï¼šå¯¹æ•°ç»„å…ƒç´ ç»§ç»­é€’å½’
- **è¿”å›å€¼**ï¼šæ‰å¹³åŒ–åçš„ç»“æœ

#### 2. æ ¸å¿ƒæ•°ç»„æ–¹æ³•
- `Array.isArray()`ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
- `Array.prototype.concat()`ï¼šåˆå¹¶æ•°ç»„
- `Array.prototype.reduce()`ï¼šç´¯ç§¯å™¨æ¨¡å¼
- `Array.prototype.some()`ï¼šæ£€æµ‹æ¡ä»¶
- å±•å¼€è¿ç®—ç¬¦ `...`ï¼šæ•°ç»„å±•å¼€

#### 3. æ€§èƒ½è€ƒé‡
- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n)ï¼Œn ä¸ºæ‰€æœ‰å…ƒç´ æ€»æ•°
- **ç©ºé—´å¤æ‚åº¦**ï¼šO(d)ï¼Œd ä¸ºæœ€å¤§åµŒå¥—æ·±åº¦
- **æ ˆæº¢å‡ºé£é™©**ï¼šæ·±åº¦è¿‡å¤§æ—¶ä½¿ç”¨è¿­ä»£æ–¹æ¡ˆ

### å››ã€å®æˆ˜åº”ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šæ ‘å½¢æ•°æ®è½¬åˆ—è¡¨

```javascript
/**
 * éƒ¨é—¨æ ‘å½¢ç»“æ„æ‰å¹³åŒ–
 */
function flattenDepartments(depts) {
    const result = [];
  
    function traverse(items, level = 0, parent = null) {
        items.forEach(item => {
            result.push({
                id: item.id,
                name: item.name,
                level,
                parentId: parent?.id
            });
            if (item.children) {
                traverse(item.children, level + 1, item);
            }
        });
    }
  
    traverse(depts);
    return result;
}
```

#### åœºæ™¯ 2ï¼šæƒé™æ•°æ®å¤„ç†

```javascript
/**
 * åµŒå¥—æƒé™æ•°ç»„æ‰å¹³åŒ–
 */
const permissions = [
    ['user', ['create', 'read', ['update', 'delete']]],
    ['admin', ['full_access']]
];

function flattenPermissions(perms) {
    return perms.map(([role, actions]) => ({
        role,
        actions: flatRecursive(actions)
    }));
}
```

#### åœºæ™¯ 3ï¼šå¤šçº§åˆ†ç±»æœç´¢

```javascript
/**
 * åˆ†ç±»æ•°æ®æ‰å¹³åŒ–ï¼ˆä¿ç•™è·¯å¾„ï¼‰
 */
function flattenCategories(categories, path = []) {
    const result = [];
  
    categories.forEach(cat => {
        const currentPath = [...path, cat.name];
        result.push({
            id: cat.id,
            name: cat.name,
            path: currentPath.join(' > ')
        });
      
        if (cat.children) {
            result.push(...flattenCategories(cat.children, currentPath));
        }
    });
  
    return result;
}
```

### äº”ã€å¢å¼ºç‰ˆå·¥å…·å‡½æ•°

```javascript
/**
 * å¸¦è¿‡æ»¤å’Œè½¬æ¢çš„æ‰å¹³åŒ–
 * @param {Array} arr - åŸæ•°ç»„
 * @param {Object} options - é…ç½®é¡¹
 * @param {number} options.depth - æ·±åº¦
 * @param {Function} options.filter - è¿‡æ»¤å‡½æ•°
 * @param {Function} options.transform - è½¬æ¢å‡½æ•°
 */
function flatWithOptions(arr, options = {}) {
    const { depth = Infinity, filter = null, transform = null } = options;
  
    function flatten(items, currentDepth) {
        const result = [];
      
        for (const item of items) {
            if (Array.isArray(item) && currentDepth > 0) {
                result.push(...flatten(item, currentDepth - 1));
            } else {
                let processed = transform ? transform(item) : item;
                if (!filter || filter(processed)) {
                    result.push(processed);
                }
            }
        }
        return result;
    }
  
    return flatten(arr, depth);
}

// ä½¿ç”¨ç¤ºä¾‹
const mixed = [1, '2', [3, null, [5, undefined]], '6'];
const clean = flatWithOptions(mixed, {
    filter: item => item != null,
    transform: item => typeof item === 'string' ? Number(item) : item
});
// ç»“æœ: [1, 2, 3, 5, 6]
```

### å…­ã€å¸¸è§é—®é¢˜å¤„ç†

#### 1. å¤„ç†å¾ªç¯å¼•ç”¨

```javascript
/**
 * é˜²æ­¢å¾ªç¯å¼•ç”¨å¯¼è‡´æ— é™é€’å½’
 */
function flatSafe(arr, seen = new WeakSet()) {
    const result = [];
  
    for (const item of arr) {
        if (Array.isArray(item)) {
            if (seen.has(item)) continue; // è·³è¿‡å·²è®¿é—®
            seen.add(item);
            result.push(...flatSafe(item, seen));
        } else {
            result.push(item);
        }
    }
    return result;
}
```

#### 2. å¤„ç†ç¨€ç–æ•°ç»„

```javascript
/**
 * è¿‡æ»¤ç©ºä½
 */
function flatDense(arr) {
    return arr.flat().filter(() => true);
    // æˆ–ä½¿ç”¨: arr.flat().filter(item => item !== undefined)
}
```

---

## ğŸš€ é¢è¯•çªå‡»æ¨¡å¼

### æ•°ç»„æ‰å¹³åŒ– é¢è¯•é€Ÿè®°

#### 30ç§’ç”µæ¢¯æ¼”è®²
æ•°ç»„æ‰å¹³åŒ–æ˜¯å°†åµŒå¥—æ•°ç»„è½¬ä¸ºä¸€ç»´æ•°ç»„ã€‚æ ¸å¿ƒæ€è·¯æ˜¯é€’å½’åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºæ•°ç»„ï¼Œå¦‚æœæ˜¯åˆ™ç»§ç»­å±•å¼€ï¼Œå¦åˆ™ç›´æ¥æ”¶é›†ã€‚ES2019 æä¾›äº†åŸç”Ÿ `flat()` æ–¹æ³•ã€‚å®ç°æ–¹å¼åŒ…æ‹¬é€’å½’ã€reduceã€è¿­ä»£æ ˆã€ç”Ÿæˆå™¨ç­‰ï¼Œéœ€è¦æ³¨æ„æ·±åº¦æ§åˆ¶å’Œæ ˆæº¢å‡ºé—®é¢˜ã€‚

---

### é«˜é¢‘è€ƒç‚¹ï¼ˆå¿…èƒŒï¼‰

**è€ƒç‚¹ 1ï¼šåŸºç¡€é€’å½’å®ç°åŸç†**
ä½¿ç”¨é€’å½’éå†æ•°ç»„ï¼Œåˆ¤æ–­æ¯ä¸ªå…ƒç´ æ˜¯å¦ä¸ºæ•°ç»„ã€‚æ˜¯åˆ™é€’å½’è°ƒç”¨ç»§ç»­å±•å¼€ï¼Œå¦åˆ™æ”¶é›†åˆ°ç»“æœæ•°ç»„ã€‚éœ€è¦è®¾ç½®é€’å½’å‡ºå£ï¼ˆæ·±åº¦é™åˆ¶æˆ–éæ•°ç»„å…ƒç´ ï¼‰é˜²æ­¢æ— é™é€’å½’ã€‚æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(d)ã€‚

**è€ƒç‚¹ 2ï¼š`Array.prototype.concat.apply([], arr)` åŸç†**
`apply` å°†æ•°ç»„å…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `concat`ï¼Œå®ç°äºŒç»´æ•°ç»„é™ç»´ã€‚ç­‰ä»·äº `[].concat(...arr)`ã€‚è¿™æ˜¯ ES5 æ—¶ä»£çš„ç»å…¸æŠ€å·§ï¼Œç°ä»£ä»£ç æ¨èä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ã€‚

**è€ƒç‚¹ 3ï¼šåŸç”Ÿ `flat()` ä¸æ‰‹å†™å®ç°çš„åŒºåˆ«**
åŸç”Ÿæ–¹æ³•æ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒæ·±åº¦å‚æ•°ï¼Œä¸ä¼šæ ˆæº¢å‡ºã€‚æ‰‹å†™å®ç°æ›´çµæ´»ï¼Œå¯æ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼ˆè¿‡æ»¤ã€è½¬æ¢ï¼‰ï¼Œä½†éœ€æ³¨æ„é€’å½’æ·±åº¦é™åˆ¶ã€‚ç”Ÿäº§ç¯å¢ƒä¼˜å…ˆåŸç”Ÿæ–¹æ³•ï¼Œé¢è¯•æ—¶å±•ç¤ºæ‰‹å†™èƒ½åŠ›ã€‚

**è€ƒç‚¹ 4ï¼šå¦‚ä½•é¿å…æ ˆæº¢å‡º**
ä½¿ç”¨è¿­ä»£æ–¹æ¡ˆä»£æ›¿é€’å½’ï¼Œé€šè¿‡æ ˆæ•°æ®ç»“æ„æ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹ã€‚æˆ–ä½¿ç”¨ç”Ÿæˆå™¨æŒ‰éœ€ç”Ÿæˆå…ƒç´ ã€‚ä¹Ÿå¯ä»¥é™åˆ¶é€’å½’æ·±åº¦ï¼Œè¶…è¿‡é™åˆ¶æ—¶ç›´æ¥è¿”å›ã€‚

**è€ƒç‚¹ 5ï¼šå¦‚ä½•æŒ‡å®šå±•å¼€æ·±åº¦**
åœ¨é€’å½’å‡½æ•°ä¸­å¢åŠ  `depth` å‚æ•°ï¼Œæ¯æ¬¡é€’å½’æ—¶ `depth - 1`ï¼Œå½“ `depth <= 0` æ—¶åœæ­¢å±•å¼€ã€‚è¿™æ ·å¯ä»¥æ§åˆ¶åªå±•å¼€ç‰¹å®šå±‚çº§çš„åµŒå¥—ã€‚

---

### ç»å…¸é¢è¯•é¢˜ï¼ˆ10é“ï¼‰

#### é¢˜ç›® 1ï¼šå®ç°åŸºç¡€çš„é€’å½’æ‰å¹³åŒ–å‡½æ•°
**æ€è·¯**ï¼šé€’å½’éå† â†’ åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ â†’ æ˜¯åˆ™é€’å½’ï¼Œå¦åˆ™æ”¶é›†
**ç­”æ¡ˆ**ï¼šéå†æ•°ç»„å…ƒç´ ï¼Œä½¿ç”¨ `Array.isArray()` åˆ¤æ–­ç±»å‹ï¼Œæ•°ç»„å…ƒç´ é€’å½’è°ƒç”¨ï¼Œéæ•°ç»„å…ƒç´ ç›´æ¥ push åˆ°ç»“æœæ•°ç»„ã€‚

```javascript
/**
 * åŸºç¡€é€’å½’æ‰å¹³åŒ–
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @returns {Array} æ‰å¹³åŒ–ç»“æœ
 */
function flat(arr) {
    const result = [];
  
    // éå†æ¯ä¸ªå…ƒç´ 
    for (let i = 0; i < arr.length; i++) {
        // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
        if (Array.isArray(arr[i])) {
            // é€’å½’å±•å¼€å¹¶åˆå¹¶ç»“æœ
            result.push(...flat(arr[i]));
        } else {
            // ç›´æ¥æ”¶é›†éæ•°ç»„å…ƒç´ 
            result.push(arr[i]);
        }
    }
  
    return result;
}

// æµ‹è¯•
console.log(flat([1, [2, [3, 4]], 5])); // [1, 2, 3, 4, 5]
```

---

#### é¢˜ç›® 2ï¼šå®ç°æ”¯æŒæŒ‡å®šæ·±åº¦çš„æ‰å¹³åŒ–
**æ€è·¯**ï¼šå¢åŠ  depth å‚æ•° â†’ æ¯æ¬¡é€’å½’å‡ 1 â†’ depth <= 0 æ—¶åœæ­¢
**ç­”æ¡ˆ**ï¼šåœ¨é€’å½’å‡½æ•°ä¸­ä¼ é€’æ·±åº¦å‚æ•°ï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨æ—¶æ·±åº¦å‡ 1ï¼Œå½“æ·±åº¦ä¸º 0 æ—¶ç›´æ¥è¿”å›å½“å‰å…ƒç´ ã€‚

```javascript
/**
 * æ”¯æŒæ·±åº¦æ§åˆ¶çš„æ‰å¹³åŒ–
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @param {number} depth - å±•å¼€æ·±åº¦ï¼Œé»˜è®¤ 1
 * @returns {Array} æ‰å¹³åŒ–ç»“æœ
 */
function flatDepth(arr, depth = 1) {
    const result = [];
  
    for (const item of arr) {
        // å¦‚æœæ˜¯æ•°ç»„ä¸”æ·±åº¦æœªåˆ°é™åˆ¶
        if (Array.isArray(item) && depth > 0) {
            // é€’å½’å±•å¼€ï¼Œæ·±åº¦å‡ 1
            result.push(...flatDepth(item, depth - 1));
        } else {
            // æ·±åº¦è¾¾åˆ°é™åˆ¶æˆ–éæ•°ç»„ï¼Œç›´æ¥æ”¶é›†
            result.push(item);
        }
    }
  
    return result;
}

// æµ‹è¯•
const nested = [1, [2, [3, [4]]]];
console.log(flatDepth(nested, 1)); // [1, 2, [3, [4]]]
console.log(flatDepth(nested, 2)); // [1, 2, 3, [4]]
console.log(flatDepth(nested, Infinity)); // [1, 2, 3, 4]
```

---

#### é¢˜ç›® 3ï¼šä½¿ç”¨ reduce å®ç°æ‰å¹³åŒ–
**æ€è·¯**ï¼šreduce ç´¯ç§¯å™¨ â†’ åˆ¤æ–­ç±»å‹ â†’ concat åˆå¹¶
**ç­”æ¡ˆ**ï¼šä½¿ç”¨ `reduce` éå†æ•°ç»„ï¼Œç´¯ç§¯å™¨åˆå§‹å€¼ä¸ºç©ºæ•°ç»„ï¼Œé‡åˆ°æ•°ç»„é€’å½’è°ƒç”¨ï¼Œå¦åˆ™ç›´æ¥ concatã€‚

```javascript
/**
 * ä½¿ç”¨ reduce å®ç°æ‰å¹³åŒ–
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @param {number} depth - å±•å¼€æ·±åº¦
 * @returns {Array} æ‰å¹³åŒ–ç»“æœ
 */
function flatReduce(arr, depth = Infinity) {
    // depth ä¸º 0 æ—¶ç›´æ¥è¿”å›å‰¯æœ¬
    if (depth === 0) return arr.slice();
  
    // reduce ç´¯ç§¯å±•å¼€
    return arr.reduce((acc, val) => {
        // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
        if (Array.isArray(val)) {
            // é€’å½’å±•å¼€å¹¶åˆå¹¶
            return acc.concat(flatReduce(val, depth - 1));
        }
        // éæ•°ç»„ç›´æ¥åˆå¹¶
        return acc.concat(val);
    }, []); // åˆå§‹å€¼ä¸ºç©ºæ•°ç»„
}

// æµ‹è¯•
console.log(flatReduce([1, [2, [3, 4]]], 2)); // [1, 2, 3, [4]]
```

---

#### é¢˜ç›® 4ï¼šä½¿ç”¨æ ˆå®ç°è¿­ä»£æ‰å¹³åŒ–ï¼ˆé¿å…æ ˆæº¢å‡ºï¼‰
**æ€è·¯**ï¼šæ ˆ + å¾ªç¯ â†’ å¼¹å‡ºå…ƒç´  â†’ æ˜¯æ•°ç»„åˆ™å±•å¼€å‹æ ˆï¼Œå¦åˆ™æ”¶é›†
**ç­”æ¡ˆ**ï¼šä½¿ç”¨æ ˆæ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹ï¼Œå°†æ•°ç»„å…ƒç´ å‹å…¥æ ˆï¼Œå¾ªç¯å¼¹å‡ºå¤„ç†ï¼Œæ•°ç»„å…ƒç´ ç»§ç»­å±•å¼€ï¼Œéæ•°ç»„å…ƒç´ æ”¶é›†åˆ°ç»“æœã€‚

```javascript
/**
 * è¿­ä»£æ–¹å¼å®ç°æ‰å¹³åŒ–ï¼ˆé˜²æ­¢æ ˆæº¢å‡ºï¼‰
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @returns {Array} æ‰å¹³åŒ–ç»“æœ
 */
function flatIterative(arr) {
    // ä½¿ç”¨æ ˆå­˜å‚¨å¾…å¤„ç†å…ƒç´ 
    const stack = [...arr];
    const result = [];
  
    // å¾ªç¯å¤„ç†æ ˆä¸­å…ƒç´ 
    while (stack.length > 0) {
        const item = stack.pop();
      
        // å¦‚æœæ˜¯æ•°ç»„ï¼Œå±•å¼€åå‹å…¥æ ˆ
        if (Array.isArray(item)) {
            stack.push(...item);
        } else {
            // éæ•°ç»„å…ƒç´ æ·»åŠ åˆ°ç»“æœå¼€å¤´ï¼ˆå› ä¸ºæ˜¯ä»åå¾€å‰å¤„ç†ï¼‰
            result.unshift(item);
        }
    }
  
    return result;
}

// æµ‹è¯•
console.log(flatIterative([1, [2, [3, [4]]]])); // [1, 2, 3, 4]
```

---

#### é¢˜ç›® 5ï¼šä½¿ç”¨ç”Ÿæˆå™¨å®ç°æ‰å¹³åŒ–
**æ€è·¯**ï¼šç”Ÿæˆå™¨å‡½æ•° â†’ yield äº§å‡ºå…ƒç´  â†’ yield* å§”æ‰˜é€’å½’
**ç­”æ¡ˆ**ï¼šå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œé‡åˆ°æ•°ç»„ä½¿ç”¨ `yield*` å§”æ‰˜ç»™é€’å½’ç”Ÿæˆå™¨ï¼Œéæ•°ç»„ä½¿ç”¨ `yield` äº§å‡ºã€‚

```javascript
/**
 * ä½¿ç”¨ç”Ÿæˆå™¨å®ç°æ‰å¹³åŒ–ï¼ˆå†…å­˜å‹å¥½ï¼‰
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @yields {*} æ‰å¹³åŒ–åçš„å…ƒç´ 
 */
function* flatGenerator(arr) {
    for (const item of arr) {
        if (Array.isArray(item)) {
            // yield* å§”æ‰˜ç»™é€’å½’ç”Ÿæˆå™¨
            yield* flatGenerator(item);
        } else {
            // yield äº§å‡ºå…ƒç´ 
            yield item;
        }
    }
}

/**
 * å°è£…ä¸ºæ™®é€šå‡½æ•°
 */
function flat(arr) {
    return [...flatGenerator(arr)];
}

// æµ‹è¯•
console.log(flat([1, [2, [3, 4]]])); // [1, 2, 3, 4]

// æŒ‰éœ€è·å–å…ƒç´ 
const gen = flatGenerator([1, [2, [3]]]);
console.log(gen.next().value); // 1
console.log(gen.next().value); // 2
```

---

#### é¢˜ç›® 6ï¼šå®ç°å¸¦è¿‡æ»¤åŠŸèƒ½çš„æ‰å¹³åŒ–
**æ€è·¯**ï¼šæ‰å¹³åŒ– + è¿‡æ»¤æ¡ä»¶ â†’ æ”¶é›†å‰åˆ¤æ–­
**ç­”æ¡ˆ**ï¼šåœ¨æ‰å¹³åŒ–è¿‡ç¨‹ä¸­å¢åŠ è¿‡æ»¤é€»è¾‘ï¼Œåªæ”¶é›†æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ã€‚

```javascript
/**
 * å¸¦è¿‡æ»¤åŠŸèƒ½çš„æ‰å¹³åŒ–
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @param {Function} filterFn - è¿‡æ»¤å‡½æ•°ï¼Œè¿”å› true åˆ™ä¿ç•™
 * @returns {Array} æ‰å¹³åŒ–å¹¶è¿‡æ»¤åçš„ç»“æœ
 */
function flatWithFilter(arr, filterFn) {
    const result = [];
  
    for (const item of arr) {
        if (Array.isArray(item)) {
            // é€’å½’å¤„ç†æ•°ç»„
            result.push(...flatWithFilter(item, filterFn));
        } else {
            // åº”ç”¨è¿‡æ»¤æ¡ä»¶
            if (filterFn(item)) {
                result.push(item);
            }
        }
    }
  
    return result;
}

// æµ‹è¯•ï¼šè¿‡æ»¤æ‰ null å’Œ undefined
const mixed = [1, null, [2, undefined, [3, null]], 4];
console.log(flatWithFilter(mixed, item => item != null)); 
// [1, 2, 3, 4]
```

---

#### é¢˜ç›® 7ï¼šå®ç°é˜²æ­¢å¾ªç¯å¼•ç”¨çš„æ‰å¹³åŒ–
**æ€è·¯**ï¼šWeakSet è®°å½•è®¿é—® â†’ æ£€æµ‹é‡å¤ â†’ è·³è¿‡å·²è®¿é—®
**ç­”æ¡ˆ**ï¼šä½¿ç”¨ WeakSet è®°å½•å·²è®¿é—®çš„æ•°ç»„å¯¹è±¡ï¼Œé‡åˆ°é‡å¤å¼•ç”¨æ—¶è·³è¿‡ï¼Œé˜²æ­¢æ— é™é€’å½’ã€‚

```javascript
/**
 * é˜²æ­¢å¾ªç¯å¼•ç”¨çš„æ‰å¹³åŒ–
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @param {WeakSet} seen - å·²è®¿é—®è®°å½•
 * @returns {Array} æ‰å¹³åŒ–ç»“æœ
 */
function flatSafe(arr, seen = new WeakSet()) {
    const result = [];
  
    for (const item of arr) {
        if (Array.isArray(item)) {
            // æ£€æµ‹å¾ªç¯å¼•ç”¨
            if (seen.has(item)) {
                console.warn('æ£€æµ‹åˆ°å¾ªç¯å¼•ç”¨ï¼Œè·³è¿‡');
                continue;
            }
          
            // è®°å½•å½“å‰æ•°ç»„
            seen.add(item);
            // é€’å½’å±•å¼€
            result.push(...flatSafe(item, seen));
        } else {
            result.push(item);
        }
    }
  
    return result;
}

// æµ‹è¯•
const circular = [1, 2];
circular.push([3, circular]); // åˆ›å»ºå¾ªç¯å¼•ç”¨
console.log(flatSafe(circular)); // [1, 2, 3] ï¼ˆè·³è¿‡å¾ªç¯å¼•ç”¨ï¼‰
```

---

#### é¢˜ç›® 8ï¼šå®ç°æ ‘å½¢æ•°æ®æ‰å¹³åŒ–ï¼ˆä¿ç•™å±‚çº§ä¿¡æ¯ï¼‰
**æ€è·¯**ï¼šé€’å½’éå† â†’ è®°å½•å±‚çº§ â†’ ä¿å­˜çˆ¶å­å…³ç³»
**ç­”æ¡ˆ**ï¼šéå†æ ‘å½¢ç»“æ„ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹è®°å½•å±‚çº§å’Œçˆ¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ‰å¹³åŒ–å­˜å‚¨ã€‚

```javascript
/**
 * æ ‘å½¢æ•°æ®æ‰å¹³åŒ–ï¼ˆä¿ç•™å±‚çº§ä¿¡æ¯ï¼‰
 * @param {Array} tree - æ ‘å½¢ç»“æ„æ•°æ®
 * @returns {Array} æ‰å¹³åŒ–ç»“æœï¼ŒåŒ…å«å±‚çº§ä¿¡æ¯
 */
function flattenTree(tree) {
    const result = [];
  
    /**
     * é€’å½’éå†
     * @param {Array} nodes - å½“å‰å±‚èŠ‚ç‚¹
     * @param {number} level - å½“å‰å±‚çº§
     * @param {Object|null} parent - çˆ¶èŠ‚ç‚¹
     */
    function traverse(nodes, level = 0, parent = null) {
        nodes.forEach(node => {
            // ä¿å­˜èŠ‚ç‚¹ä¿¡æ¯ï¼ˆä¸åŒ…å« childrenï¼‰
            result.push({
                id: node.id,
                name: node.name,
                level,
                parentId: parent?.id || null
            });
          
            // é€’å½’å¤„ç†å­èŠ‚ç‚¹
            if (node.children && node.children.length > 0) {
                traverse(node.children, level + 1, node);
            }
        });
    }
  
    traverse(tree);
    return result;
}

// æµ‹è¯•
const departments = [
    {
        id: 1, name: 'æŠ€æœ¯éƒ¨', children: [
            { id: 2, name: 'å‰ç«¯ç»„', children: [] },
            { id: 3, name: 'åç«¯ç»„', children: [] }
        ]
    },
    { id: 4, name: 'äº§å“éƒ¨', children: [] }
];

console.log(flattenTree(departments));
/* è¾“å‡º:
[
  { id: 1, name: 'æŠ€æœ¯éƒ¨', level: 0, parentId: null },
  { id: 2, name: 'å‰ç«¯ç»„', level: 1, parentId: 1 },
  { id: 3, name: 'åç«¯ç»„', level: 1, parentId: 1 },
  { id: 4, name: 'äº§å“éƒ¨', level: 0, parentId: null }
]
*/
```

---

#### é¢˜ç›® 9ï¼šå®ç°å¯¹è±¡æ•°ç»„çš„é€’å½’æ‰å¹³åŒ–
**æ€è·¯**ï¼šé€’å½’éå†å¯¹è±¡å±æ€§ â†’ åˆ¤æ–­å€¼ç±»å‹ â†’ å±•å¼€åµŒå¥—
**ç­”æ¡ˆ**ï¼šéå†å¯¹è±¡å±æ€§ï¼Œå¦‚æœå€¼æ˜¯æ•°ç»„åˆ™é€’å½’æ‰å¹³åŒ–ï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™é€’å½’å¤„ç†ã€‚

```javascript
/**
 * å¯¹è±¡æ•°ç»„çš„æ·±åº¦æ‰å¹³åŒ–
 * @param {Object} obj - åŒ…å«åµŒå¥—æ•°ç»„çš„å¯¹è±¡
 * @returns {Object} æ‰å¹³åŒ–åçš„å¯¹è±¡
 */
function flattenObject(obj) {
    const result = {};
  
    /**
     * é€’å½’å¤„ç†å¯¹è±¡
     * @param {*} value - å½“å‰å€¼
     * @param {string} prefix - é”®å‰ç¼€
     */
    function flatten(value, prefix = '') {
        if (Array.isArray(value)) {
            // æ•°ç»„æ‰å¹³åŒ–åå†å¤„ç†
            const flattened = flat(value);
            result[prefix] = flattened;
        } else if (typeof value === 'object' && value !== null) {
            // é€’å½’å¤„ç†å¯¹è±¡å±æ€§
            Object.keys(value).forEach(key => {
                const newKey = prefix ? `${prefix}.${key}` : key;
                flatten(value[key], newKey);
            });
        } else {
            // åŸºç¡€ç±»å‹ç›´æ¥èµ‹å€¼
            result[prefix] = value;
        }
    }
  
    flatten(obj);
    return result;
}

// æµ‹è¯•
const nested = {
    name: 'test',
    tags: [1, [2, [3]]],
    info: {
        items: [4, [5]]
    }
};

console.log(flattenObject(nested));
/* è¾“å‡º:
{
  name: 'test',
  tags: [1, 2, 3],
  'info.items': [4, 5]
}
*/
```

---

#### é¢˜ç›® 10ï¼šå®ç°å¸¦ç»Ÿè®¡ä¿¡æ¯çš„æ‰å¹³åŒ–
**æ€è·¯**ï¼šæ‰å¹³åŒ–è¿‡ç¨‹ä¸­æ”¶é›†ç»Ÿè®¡æ•°æ® â†’ è®°å½•æœ€å¤§æ·±åº¦ã€å…ƒç´ æ•°é‡
**ç­”æ¡ˆ**ï¼šåœ¨é€’å½’è¿‡ç¨‹ä¸­è®°å½•ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿”å›æ‰å¹³åŒ–ç»“æœå’Œç»Ÿè®¡æ•°æ®ã€‚

```javascript
/**
 * å¸¦ç»Ÿè®¡ä¿¡æ¯çš„æ‰å¹³åŒ–
 * @param {Array} arr - å¾…æ‰å¹³åŒ–æ•°ç»„
 * @returns {Object} åŒ…å«ç»“æœå’Œç»Ÿè®¡ä¿¡æ¯
 */
function flatWithStats(arr) {
    // ç»Ÿè®¡ä¿¡æ¯
    const stats = {
        maxDepth: 0,      // æœ€å¤§åµŒå¥—æ·±åº¦
        totalElements: 0,  // å…ƒç´ æ€»æ•°
        arrayCount: 0      // æ•°ç»„æ•°é‡
    };
  
    /**
     * é€’å½’æ‰å¹³åŒ–
     * @param {Array} items - å½“å‰æ•°ç»„
     * @param {number} depth - å½“å‰æ·±åº¦
     * @returns {Array} æ‰å¹³åŒ–ç»“æœ
     */
    function flatten(items, depth = 0) {
        // æ›´æ–°æœ€å¤§æ·±åº¦
        stats.maxDepth = Math.max(stats.maxDepth, depth);
        const result = [];
      
        for (const item of items) {
            stats.totalElements++; // ç»Ÿè®¡å…ƒç´ æ•°é‡
          
            if (Array.isArray(item)) {
                stats.arrayCount++; // ç»Ÿè®¡æ•°ç»„æ•°é‡
                // é€’å½’å±•å¼€
                result.push(...flatten(item, depth + 1));
            } else {
                result.push(item);
            }
        }
      
        return result;
    }
  
    const result = flatten(arr);
  
    return {
        result,
        stats
    };
}

// æµ‹è¯•
const nested = [1, [2, [3, [4]]], 5];
const { result, stats } = flatWithStats(nested);

console.log('ç»“æœ:', result);         // [1, 2, 3, 4, 5]
console.log('æœ€å¤§æ·±åº¦:', stats.maxDepth);      // 3
console.log('å…ƒç´ æ€»æ•°:', stats.totalElements);  // 8
console.log('æ•°ç»„æ•°é‡:', stats.arrayCount);     // 3
```

---

### è®°å¿†å£è¯€

**"é€’å½’åˆ¤æ–­ï¼Œå±•å¼€æ”¶é›†"**
- é€’å½’éå†æ•°ç»„å…ƒç´ 
- åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ç±»å‹
- æ˜¯åˆ™é€’å½’å±•å¼€ï¼Œå¦åˆ™ç›´æ¥æ”¶é›†
- æ§åˆ¶æ·±åº¦é¿å…æ ˆæº¢å‡º

**å…³é”® API**ï¼š`Array.isArray()` + å±•å¼€è¿ç®—ç¬¦ `...` + `concat()`