<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>API Image参数生成器 (纯Base64)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: 0 auto; color: #333; }
        h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        p { color: #555; }
        .warning { background-color: #fffbe6; border: 1px solid #ffe58f; padding: 10px; border-radius: 4px; margin-bottom: 20px;}
        input[type="file"] { display: block; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; }
        #output-container { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; display: none; }
        #output-area { width: 100%; height: 200px; font-family: "Courier New", Courier, monospace; font-size: 14px; background: #fff; border: 1px solid #ccc; word-break: break-all; box-sizing: border-box; }
        .info, .error { font-size: 0.9em; margin-top: 10px; }
        .info { color: #006400; }
        .error { color: #d32f2f; font-weight: bold; }
        #copy-button { display: inline-block; padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; font-size: 14px; }
        #copy-button:hover { background-color: #0056b3; }
        #copy-button:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <h1>API `image` 参数生成器 (纯Base64版)</h1>
    <div class="warning">
        <strong>重要提示:</strong> 此工具只生成纯Base64字符串。您无需再手动进行URL编码。直接将结果粘贴到Bruno等工具的 `Form-Url-Encoded` 值中，工具会自动完成URL编码。
    </div>
    
    <input type="file" id="imageInput" accept="image/jpeg, image/png, image/bmp">

    <div id="output-container">
        <h3>生成的纯Base64字符串:</h3>
        <textarea id="output-area" readonly placeholder="这里将显示处理后的字符串..."></textarea>
        <button id="copy-button" disabled>复制到剪贴板</button>
        <div id="info" class="info"></div>
        <div id="error" class="error"></div>
    </div>
    
    <script>
        const imageInput = document.getElementById('imageInput');
        const outputContainer = document.getElementById('output-container');
        const outputArea = document.getElementById('output-area');
        const infoDiv = document.getElementById('info');
        const errorDiv = document.getElementById('error');
        const copyButton = document.getElementById('copy-button');

        imageInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            
            outputContainer.style.display = 'block';
            outputArea.value = '';
            infoDiv.textContent = '';
            errorDiv.textContent = '';
            copyButton.disabled = true;

            if (!file) {
                infoDiv.textContent = '未选择文件。';
                return;
            }

            try {
                // 步骤1: 读取文件并转换为纯净的Base64字符串
                infoDiv.textContent = '正在进行Base64编码...';
                const base64String = await fileToBase64(file);
                
                // 步骤2: 直接显示结果，不再进行URL编码！
                outputArea.value = base64String;
                copyButton.disabled = false;
                
                const originalSize = (file.size / 1024).toFixed(2);
                infoDiv.innerHTML = `✅ Base64编码完成！<br>
                                   - 原始图片大小: <strong>${originalSize} KB</strong><br>`;

            } catch (error) {
                console.error('转换失败:', error);
                errorDiv.textContent = `❌ 转换失败: ${error.message}`;
            }
        });

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64WithPrefix = reader.result;
                    const parts = base64WithPrefix.split(',');
                    if (parts.length > 1 && parts[1]) {
                         resolve(parts[1]);
                    } else {
                        reject(new Error("无法从文件中解析出Base64数据。"));
                    }
                };
                reader.onerror = error => reject(error);
            });
        }
        
        copyButton.addEventListener('click', () => {
            if (!outputArea.value) return;
            navigator.clipboard.writeText(outputArea.value).then(() => {
                copyButton.textContent = '已复制!';
                setTimeout(() => { copyButton.textContent = '复制到剪贴板'; }, 2000);
            });
        });
    </script>
</body>
</html>
